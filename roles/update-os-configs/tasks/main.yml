---

- name: Change various sysctl-settings, look at the sysctl-vars file for documentation
  sysctl:
    name: '{{ item.key }}'
    value: '{{ item.value }}'
    sysctl_set: yes
    state: present
    reload: yes
    ignoreerrors: yes
  with_dict: '{{ rvar_osconfigs_sysctl }}'
  when: rvar_osconfigs_sysctl is defined
  register: updatessysctl

- name: Add or modify fsize hard limits
  pam_limits:
    domain: '{{ item.domain }}'
    limit_type: '{{ item.type }}'
    limit_item: '{{ item.item }}'
    value: '{{ item.value }}'
    comment: '{{ item.comment }}'
  with_items: '{{ rvar_osconfigs_limits }}'
  when: rvar_osconfigs_limits is defined
  register: updateslimits

- name: reboot if any of the settings were changed
  reboot:
    reboot_timeout: 600
  when: rvar_osconfigs_allow_reboot and (updatessysctl.changed or updateslimits.changed)